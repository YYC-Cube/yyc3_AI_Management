# ğŸ§ª YanYu CloudÂ³ æµ‹è¯•ä½“ç³»å®Œå–„æŒ‡å—# ğŸ§ª YanYu CloudÂ³ æµ‹è¯•ä½“ç³»å®Œå–„æŒ‡å—

> **é«˜ä¼˜å…ˆçº§æ”¹è¿›æ–¹å‘**: å°†æµ‹è¯•è¦†ç›–ç‡ä» 65%æå‡åˆ° 80%+ï¼Œå»ºç«‹å®Œå–„çš„æµ‹è¯•ä½“ç³»> **é«˜ä¼˜å…ˆçº§æ”¹è¿›æ–¹å‘**: å°†æµ‹è¯•è¦†ç›–ç‡ä» 65%æå‡åˆ° 80%+ï¼Œå»ºç«‹å®Œå–„çš„æµ‹è¯•ä½“ç³»

## ğŸ“‹ ç›®å½•## ğŸ“‹ ç›®å½•

1. [æµ‹è¯•ç­–ç•¥ä¸æ¶æ„](#1-æµ‹è¯•ç­–ç•¥ä¸æ¶æ„)1. [æµ‹è¯•ç­–ç•¥ä¸æ¶æ„](#æµ‹è¯•ç­–ç•¥ä¸æ¶æ„)

2. [é…ç½®ä¸ç¯å¢ƒè®¾ç½®](#2-é…ç½®ä¸ç¯å¢ƒè®¾ç½®)2. [é…ç½®ä¸ç¯å¢ƒè®¾ç½®](#é…ç½®ä¸ç¯å¢ƒè®¾ç½®)

3. [å•å…ƒæµ‹è¯•](#3-å•å…ƒæµ‹è¯•)3. [å•å…ƒæµ‹è¯•](#å•å…ƒæµ‹è¯•)

4. [é›†æˆæµ‹è¯•](#4-é›†æˆæµ‹è¯•)4. [é›†æˆæµ‹è¯•](#é›†æˆæµ‹è¯•)

5. [ç«¯åˆ°ç«¯æµ‹è¯•](#5-ç«¯åˆ°ç«¯æµ‹è¯•)5. [E2E æµ‹è¯•](#e2eæµ‹è¯•)

6. [æ€§èƒ½æµ‹è¯•](#6-æ€§èƒ½æµ‹è¯•)6. [æ€§èƒ½æµ‹è¯•](#æ€§èƒ½æµ‹è¯•)

7. [CI/CD é›†æˆ](#7-cicdé›†æˆ)7. [CI/CD é›†æˆ](#cicdé›†æˆ)

8. [æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡](#8-æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡)8. [æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡](#æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡)

9. [è´¨é‡é—¨ç¦æœºåˆ¶](#9-è´¨é‡é—¨ç¦æœºåˆ¶)9. [è´¨é‡é—¨ç¦æœºåˆ¶](#è´¨é‡é—¨ç¦æœºåˆ¶)

10. [æœ€ä½³å®è·µ](#10-æœ€ä½³å®è·µ)10. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

## 1. æµ‹è¯•ç­–ç•¥ä¸æ¶æ„## æµ‹è¯•ç­–ç•¥

### å½“å‰çŠ¶æ€åˆ†æ### æµ‹è¯•é‡‘å­—å¡”

- **å•å…ƒæµ‹è¯•è¦†ç›–ç‡**: 65% â†’ ç›®æ ‡: 80%+\`\`\`

- **é›†æˆæµ‹è¯•**: åŸºç¡€è®¾ç½® â†’ ç›®æ ‡: 70%+/\

- **E2E æµ‹è¯•**: å¾…å®Œå–„ â†’ ç›®æ ‡: 60%+ /E2E\

- **è‡ªåŠ¨åŒ–ç¨‹åº¦**: 40% â†’ ç›®æ ‡: 85%+ /------\

/Integration\

### æµ‹è¯•é‡‘å­—å¡”æ¶æ„ /-------------\

/ Unit Tests \

````/-----------------\

    E2E æµ‹è¯• (20%)\`\`\`

    â”œâ”€â”€ å…³é”®ä¸šåŠ¡æµç¨‹

    â”œâ”€â”€ ç”¨æˆ·å®Œæ•´æ—…ç¨‹- **å•å…ƒæµ‹è¯•**: 70% è¦†ç›–ç‡

    â””â”€â”€ è·¨ç³»ç»Ÿé›†æˆ- **é›†æˆæµ‹è¯•**: 20% è¦†ç›–ç‡

- **E2Eæµ‹è¯•**: 10% è¦†ç›–ç‡

  é›†æˆæµ‹è¯• (30%)

  â”œâ”€â”€ APIæ¥å£æµ‹è¯•## å•å…ƒæµ‹è¯•

  â”œâ”€â”€ æ•°æ®åº“é›†æˆ

  â”œâ”€â”€ å¤–éƒ¨æœåŠ¡é›†æˆ### åç«¯æœåŠ¡æµ‹è¯•

  â””â”€â”€ ç»„ä»¶é—´äº¤äº’

#### æµ‹è¯•æ¡†æ¶

å•å…ƒæµ‹è¯• (50%)

â”œâ”€â”€ ä¸šåŠ¡é€»è¾‘æµ‹è¯•- Jest

â”œâ”€â”€ å·¥å…·å‡½æ•°æµ‹è¯•- Supertest (APIæµ‹è¯•)

â”œâ”€â”€ ç»„ä»¶å•å…ƒæµ‹è¯•- ts-jest (TypeScriptæ”¯æŒ)

â””â”€â”€ æœåŠ¡å±‚æµ‹è¯•

```#### æµ‹è¯•ç»“æ„



### æŠ€æœ¯æ ˆé€‰æ‹©\`\`\`typescript

describe('ServiceName', () => {

**å‰ç«¯æµ‹è¯•**:let service: ServiceName



- **æ¡†æ¶**: Jest + React Testing LibrarybeforeEach(() => {

- **E2E**: Playwright// åˆå§‹åŒ–

- **å¿«ç…§æµ‹è¯•**: Jest Snapshots})

- **Mock**: Jest Mocks + MSW

afterEach(() => {

**åç«¯æµ‹è¯•**:// æ¸…ç†

jest.clearAllMocks()

- **æ¡†æ¶**: Jest + Supertest})

- **æ•°æ®åº“**: Test Database + Docker

- **APIæµ‹è¯•**: Supertest + HTTP assertionsdescribe('methodName', () => {

- **Mock**: Jest Mocks + Sinonit('should do something', async () => {

// Arrange

## 2. é…ç½®ä¸ç¯å¢ƒè®¾ç½®const input = {}



### Jest é…ç½®      // Act

      const result = await service.methodName(input)

```javascript

// jest.config.js      // Assert

module.exports = {      expect(result).toBeDefined()

  // åŸºç¡€é…ç½®    })

  preset: 'ts-jest',

  testEnvironment: 'node',})

  roots: ['<rootDir>/src', '<rootDir>/tests'],})

  \`\`\`

  // æµ‹è¯•æ–‡ä»¶åŒ¹é…

  testMatch: [#### Mockç­–ç•¥

    '**/__tests__/**/*.(ts|tsx|js)',

    '**/*.(test|spec).(ts|tsx|js)'\`\`\`typescript

  ],// Mockå¤–éƒ¨ä¾èµ–

  jest.mock('../config/database')

  // TypeScript æ”¯æŒjest.mock('../config/redis')

  transform: {

    '^.+\\.tsx?$': 'ts-jest',// Mockå‡½æ•°

  },const mockFunction = jest.fn().mockResolvedValue({})

  \`\`\`

  // æ¨¡å—è§£æ

  moduleNameMapping: {### å‰ç«¯ç»„ä»¶æµ‹è¯•

    '^@/(.*)$': '<rootDir>/src/$1',

    '^@components/(.*)$': '<rootDir>/src/components/$1',#### æµ‹è¯•æ¡†æ¶

    '^@utils/(.*)$': '<rootDir>/src/utils/$1',

  },- Vitest

  - React Testing Library

  // è¦†ç›–ç‡é…ç½®- @testing-library/user-event

  collectCoverage: true,

  coverageDirectory: 'coverage',#### ç»„ä»¶æµ‹è¯•ç¤ºä¾‹

  coverageReporters: ['text', 'lcov', 'html', 'json-summary'],

  \`\`\`typescript

  // è¦†ç›–ç‡é˜ˆå€¼ - é«˜ä¼˜å…ˆçº§æ”¹è¿›import { render, screen } from '@testing-library/react'

  coverageThreshold: {import userEvent from '@testing-library/user-event'

    global: {import { Button } from './Button'

      branches: 80,

      functions: 80,describe('Button', () => {

      lines: 80,it('renders button with text', () => {

      statements: 80render(<Button>Click me</Button>)

    },expect(screen.getByText('Click me')).toBeInTheDocument()

    './src/core/': {})

      branches: 90,

      functions: 90,it('calls onClick when clicked', async () => {

      lines: 90,const handleClick = jest.fn()

      statements: 90render(<Button onClick={handleClick}>Click</Button>)

    },

    './src/services/': {    await userEvent.click(screen.getByText('Click'))

      branches: 85,    expect(handleClick).toHaveBeenCalledTimes(1)

      functions: 85,

      lines: 85,})

      statements: 85})

    }\`\`\`

  },

  ## é›†æˆæµ‹è¯•

  // å¿½ç•¥æ–‡ä»¶

  coveragePathIgnorePatterns: [### APIé›†æˆæµ‹è¯•

    '/node_modules/',

    '/dist/',\`\`\`typescript

    '/coverage/',import request from 'supertest'

    '/__tests__/',import { app } from '../server'

    '/migrations/',

    '/scripts/'describe('Reconciliation API', () => {

  ],it('should create a reconciliation record', async () => {

  const response = await request(app)

  // æµ‹è¯•ç¯å¢ƒè®¾ç½®.post('/api/reconciliation/records')

  setupFilesAfterEnv: ['<rootDir>/tests/setup.ts'],.set('Authorization', 'Bearer valid-token')

  .send({

  // è¶…æ—¶è®¾ç½®transactionDate: '2024-01-15',

  testTimeout: 30000,amount: 1000,

  // ...

  // å¹¶è¡Œæµ‹è¯•})

  maxWorkers: '50%',.expect(201)

}

```    expect(response.body.success).toBe(true)

    expect(response.body.data.recordNumber).toMatch(/^REC-/)

### Playwright E2E é…ç½®

})

```typescript})

// playwright.config.ts\`\`\`

import { defineConfig, devices } from '@playwright/test'

### æ•°æ®åº“é›†æˆæµ‹è¯•

export default defineConfig({

  testDir: './tests/e2e',\`\`\`typescript

  fullyParallel: true,describe('Database Integration', () => {

  forbidOnly: !!process.env.CI,beforeAll(async () => {

  retries: process.env.CI ? 2 : 0,await pool.query('BEGIN')

  workers: process.env.CI ? 1 : undefined,})

  reporter: [

    ['html'],afterAll(async () => {

    ['json', { outputFile: 'test-results/results.json' }]await pool.query('ROLLBACK')

  ],await pool.end()

  })

  use: {

    baseURL: 'http://127.0.0.1:3000',it('should perform database operations', async () => {

    trace: 'on-first-retry',// æµ‹è¯•é€»è¾‘

    screenshot: 'only-on-failure',})

    video: 'retain-on-failure',})

  },\`\`\`



  projects: [## E2Eæµ‹è¯•

    {

      name: 'chromium',### Playwrightæµ‹è¯•

      use: { ...devices['Desktop Chrome'] },

    },#### å®‰è£…

    {

      name: 'firefox',\`\`\`bash

      use: { ...devices['Desktop Firefox'] },npm install -D @playwright/test

    },npx playwright install

    {\`\`\`

      name: 'webkit',

      use: { ...devices['Desktop Safari'] },#### æµ‹è¯•ç¤ºä¾‹

    },

    {\`\`\`typescript

      name: 'Mobile Chrome',import { test, expect } from '@playwright/test'

      use: { ...devices['Pixel 5'] },

    },test.describe('User Login Flow', () => {

  ],test('should login successfully', async ({ page }) => {

await page.goto('<http://localhost:3000>')

  webServer: {

    command: 'npm run dev',    await page.fill('[name="email"]', 'user@example.com')

    url: 'http://127.0.0.1:3000',    await page.fill('[name="password"]', 'password123')

    reuseExistingServer: !process.env.CI,    await page.click('button[type="submit"]')

  },

})    await expect(page).toHaveURL('/dashboard')

```    await expect(page.locator('text=Welcome')).toBeVisible()



## 3. å•å…ƒæµ‹è¯•})

})

### ä¸šåŠ¡é€»è¾‘æµ‹è¯•ç¤ºä¾‹\`\`\`



```typescript#### å…³é”®æµ‹è¯•åœºæ™¯

// src/services/__tests__/reconciliation.service.test.ts

import { ReconciliationService } from '../reconciliation.service'1. **ç”¨æˆ·è®¤è¯æµç¨‹**

import { mockDatabase } from '../../__mocks__/database'   - ç™»å½•/ç™»å‡º

   - å¯†ç é‡ç½®

describe('ReconciliationService', () => {   - æƒé™éªŒè¯

  let service: ReconciliationService

  2. **è´¢åŠ¡å¯¹è´¦æµç¨‹**

  beforeEach(() => {   - CSVå¯¼å…¥

    service = new ReconciliationService(mockDatabase)   - è‡ªåŠ¨å¯¹è´¦

    jest.clearAllMocks()   - å¼‚å¸¸å¤„ç†

  })   - AIåˆ†æ



  describe('autoReconcile', () => {3. **å·¥å•ç³»ç»Ÿ**

    it('should match records within tolerance', async () => {   - åˆ›å»ºå·¥å•

      // Arrange   - çŠ¶æ€æ›´æ–°

      const records = [   - æ¶ˆæ¯å‘é€

        { id: 1, amount: 100.00, date: '2024-01-01' },

        { id: 2, amount: 100.05, date: '2024-01-01' }## æ€§èƒ½æµ‹è¯•

      ]

      mockDatabase.getUnmatchedRecords.mockResolvedValue(records)### k6è´Ÿè½½æµ‹è¯•



      // Act#### å®‰è£…

      const result = await service.autoReconcile(0.1)

      \`\`\`bash

      // Assertbrew install k6 # macOS

      expect(result.matched).toBe(1)

      expect(result.matchRate).toBeCloseTo(0.5)# or

      expect(mockDatabase.updateRecordStatus).toHaveBeenCalledWith(

        [1, 2], curl <https://github.com/grafana/k6/releases/download/v0.46.0/k6-v0.46.0-linux-amd64.tar.gz> -L | tar xvz --strip-components 1

        'matched'\`\`\`

      )

    })#### æµ‹è¯•è„šæœ¬



    it('should handle empty records gracefully', async () => {\`\`\`javascript

      // Arrangeimport http from 'k6/http'

      mockDatabase.getUnmatchedRecords.mockResolvedValue([])import { check, sleep } from 'k6'



      // Actexport const options = {

      const result = await service.autoReconcile(0.1)stages: [

      { duration: '1m', target: 100 }, // çˆ¬å‡è‡³100ç”¨æˆ·

      // Assert{ duration: '3m', target: 100 }, // ä¿æŒ100ç”¨æˆ·

      expect(result.matched).toBe(0){ duration: '1m', target: 0 }, // é™è‡³0

      expect(result.matchRate).toBe(0)],

    })thresholds: {

  })http_req_duration: ['p(95)<500'], // 95%è¯·æ±‚ < 500ms

})http_req_failed: ['rate<0.01'], // é”™è¯¯ç‡ < 1%

```},

}

### Reactç»„ä»¶æµ‹è¯•ç¤ºä¾‹

export default function () {

```typescriptconst res = http.get('<http://localhost:3001/api/health>')

// src/components/__tests__/KpiCard.test.tsx

import React from 'react'check(res, {

import { render, screen } from '@testing-library/react''status is 200': (r) => r.status === 200,

import { KpiCard } from '../KpiCard''response time OK': (r) => r.timings.duration < 500,

})

describe('KpiCard', () => {

  const defaultProps = {sleep(1)

    title: 'æ€»æ”¶å…¥',}

    value: 1234567.89,\`\`\`

    currency: 'ï¿¥',

    change: 5.4,#### è¿è¡Œæµ‹è¯•

    timeframe: 'æœ¬æœˆ',

    trend: 'up' as const\`\`\`bash

  }k6 run backend/performance/k6-load-test.js

\`\`\`

  it('renders title and value correctly', () => {

    render(<KpiCard {...defaultProps} />)## æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡



    expect(screen.getByText('æ€»æ”¶å…¥')).toBeInTheDocument()### ç›®æ ‡æŒ‡æ ‡

    expect(screen.getByText('ï¿¥1,234,567.89')).toBeInTheDocument()

  })- **æ€»ä½“è¦†ç›–ç‡**: 80%+

- **å…³é”®ä¸šåŠ¡é€»è¾‘**: 95%+

  it('shows positive trend indicator', () => {- **å·¥å…·å‡½æ•°**: 90%+

    render(<KpiCard {...defaultProps} />)- **UIç»„ä»¶**: 75%+



    const trendElement = screen.getByTestId('trend-indicator')### è¦†ç›–ç‡æŠ¥å‘Š

    expect(trendElement).toHaveClass('text-green-600')

    expect(screen.getByText('+5.4%')).toBeInTheDocument()\`\`\`bash

  })

# åç«¯

  it('shows negative trend indicator', () => {

    render(npm run test:coverage

      <KpiCard

        {...defaultProps} # å‰ç«¯

        change={-2.1}

        trend="down" npm run test:ui -- --coverage

      />\`\`\`

    )

    ### CI/CDé›†æˆ

    const trendElement = screen.getByTestId('trend-indicator')

    expect(trendElement).toHaveClass('text-red-600')\`\`\`yaml

    expect(screen.getByText('-2.1%')).toBeInTheDocument()

  })# .github/workflows/test.yml

})

```- name: Run Tests

  run: npm test -- --coverage

### Mockç­–ç•¥- name: Upload Coverage

  uses: codecov/codecov-action@v3

```typescript  with:

// å¤–éƒ¨ä¾èµ–Mock  files: ./coverage/lcov.info

jest.mock('../config/database')

jest.mock('../config/redis')- name: Check Coverage Threshold

jest.mock('../config/openai')  run: |

  if [ $(cat coverage/coverage-summary.json | jq '.total.lines.pct') -lt 80 ]; then

// å‡½æ•°Mock  echo "Coverage below 80%"

const mockFunction = jest.fn().mockResolvedValue({})  exit 1

  fi

// ç±»Mock  \`\`\`

jest.mock('../services/EmailService', () => ({

  EmailService: jest.fn().mockImplementation(() => ({## æœ€ä½³å®è·µ

    sendEmail: jest.fn().mockResolvedValue(true)

  }))1. **æµ‹è¯•å‘½å**: æ¸…æ™°æè¿°æµ‹è¯•æ„å›¾

}))2. **æµ‹è¯•éš”ç¦»**: æ¯ä¸ªæµ‹è¯•ç‹¬ç«‹è¿è¡Œ

```3. **Mockå¤–éƒ¨ä¾èµ–**: é¿å…æµ‹è¯•ä¾èµ–å¤–éƒ¨æœåŠ¡

4. **å¿«é€Ÿåé¦ˆ**: å•å…ƒæµ‹è¯•åº”åœ¨ç§’çº§å®Œæˆ

## 4. é›†æˆæµ‹è¯•5. **æŒç»­ç»´æŠ¤**: éšä»£ç æ›´æ–°æµ‹è¯•

6. **å¯è¯»æ€§**: æµ‹è¯•ä»£ç åº”æ˜“äºç†è§£

### API é›†æˆæµ‹è¯•7. **è¦†ç›–è¾¹ç•Œæ¡ä»¶**: æµ‹è¯•æ­£å¸¸ã€å¼‚å¸¸ã€è¾¹ç•Œæƒ…å†µ



```typescript## è¿è¡Œæµ‹è¯•

// tests/integration/reconciliation-api.test.ts

import request from 'supertest'\`\`\`bash

import { app } from '../../src/server'

import { setupTestDatabase, teardownTestDatabase } from '../utils/test-db'# è¿è¡Œæ‰€æœ‰æµ‹è¯•

import { createTestUser, getTestToken } from '../utils/test-auth'

npm test

describe('Reconciliation API Integration', () => {

  let testToken: string# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶



  beforeAll(async () => {npm test -- reconciliation.service.test.ts

    await setupTestDatabase()

    const user = await createTestUser()# ç›‘è§†æ¨¡å¼

    testToken = await getTestToken(user.id)

  })npm test -- --watch



  afterAll(async () => {# è¦†ç›–ç‡æŠ¥å‘Š

    await teardownTestDatabase()

  })npm run test:coverage



  describe('POST /api/reconciliation/import', () => {# E2Eæµ‹è¯•

    it('should import CSV file successfully', async () => {

      const response = await request(app)npm run test:e2e

        .post('/api/reconciliation/import')

        .attach('file', 'tests/fixtures/sample-transactions.csv')# æ€§èƒ½æµ‹è¯•

        .set('Authorization', `Bearer ${testToken}`)

        .expect(200)npm run test:performance

\`\`\`

      expect(response.body.success).toBe(true)
      expect(response.body.data.recordsImported).toBeGreaterThan(0)
      expect(response.body.data.errors).toHaveLength(0)
    })

    it('should reject invalid file format', async () => {
      const response = await request(app)
        .post('/api/reconciliation/import')
        .attach('file', 'tests/fixtures/invalid.txt')
        .set('Authorization', `Bearer ${testToken}`)
        .expect(400)

      expect(response.body.success).toBe(false)
      expect(response.body.error).toContain('Invalid file format')
    })
  })

  describe('POST /api/reconciliation/auto-reconcile', () => {
    beforeEach(async () => {
      // å‡†å¤‡æµ‹è¯•æ•°æ®
      await request(app)
        .post('/api/reconciliation/import')
        .attach('file', 'tests/fixtures/sample-transactions.csv')
        .set('Authorization', `Bearer ${testToken}`)
    })

    it('should perform auto reconciliation', async () => {
      const response = await request(app)
        .post('/api/reconciliation/auto-reconcile')
        .send({ tolerance: 0.05 })
        .set('Authorization', `Bearer ${testToken}`)
        .expect(200)

      expect(response.body.success).toBe(true)
      expect(response.body.data.matched).toBeGreaterThanOrEqual(0)
      expect(response.body.data.matchRate).toBeGreaterThanOrEqual(0)
    })
  })
})
````

### æ•°æ®åº“é›†æˆæµ‹è¯•

```typescript
describe("Database Integration", () => {
  beforeAll(async () => {
    await pool.query("BEGIN");
  });

  afterAll(async () => {
    await pool.query("ROLLBACK");
    await pool.end();
  });

  it("should perform complex query operations", async () => {
    // æ’å…¥æµ‹è¯•æ•°æ®
    const insertResult = await pool.query(
      "INSERT INTO reconciliation_records (amount, date) VALUES ($1, $2) RETURNING id",
      [100.5, "2024-01-01"]
    );

    // éªŒè¯æ’å…¥
    expect(insertResult.rows[0].id).toBeDefined();

    // æŸ¥è¯¢éªŒè¯
    const selectResult = await pool.query(
      "SELECT * FROM reconciliation_records WHERE id = $1",
      [insertResult.rows[0].id]
    );

    expect(selectResult.rows[0].amount).toBe(100.5);
  });
});
```

## 5. ç«¯åˆ°ç«¯æµ‹è¯•

### å®Œæ•´ä¸šåŠ¡æµç¨‹æµ‹è¯•

```typescript
// tests/e2e/reconciliation-flow.spec.ts
import { test, expect, Page } from "@playwright/test";

test.describe("Reconciliation Complete Flow", () => {
  let page: Page;

  test.beforeEach(async ({ page: testPage }) => {
    page = testPage;

    // ç™»å½•
    await page.goto("/login");
    await page.fill('[data-testid="email"]', "test@example.com");
    await page.fill('[data-testid="password"]', "password123");
    await page.click('[data-testid="login-button"]');
    await page.waitForURL("/dashboard");
  });

  test("should complete reconciliation workflow", async () => {
    // 1. å¯¼èˆªåˆ°å¯¹è´¦é¡µé¢
    await page.click('[data-testid="nav-reconciliation"]');
    await page.waitForURL("/reconciliation");

    // 2. ä¸Šä¼ CSVæ–‡ä»¶
    await page.setInputFiles(
      '[data-testid="file-upload"]',
      "tests/fixtures/sample-transactions.csv"
    );
    await page.click('[data-testid="upload-button"]');

    // 3. ç­‰å¾…ä¸Šä¼ å®Œæˆ
    await expect(page.locator('[data-testid="upload-success"]')).toBeVisible();
    await expect(page.locator('[data-testid="records-count"]')).toContainText(
      /\d+ æ¡è®°å½•/
    );

    // 4. æ‰§è¡Œè‡ªåŠ¨å¯¹è´¦
    await page.click('[data-testid="auto-reconcile-button"]');
    await page.waitForSelector('[data-testid="reconcile-progress"]');
    await page.waitForSelector('[data-testid="reconcile-complete"]', {
      timeout: 30000,
    });

    // 5. éªŒè¯ç»“æœ
    const matchedCount = await page
      .locator('[data-testid="matched-count"]')
      .textContent();
    expect(parseInt(matchedCount || "0")).toBeGreaterThan(0);

    const matchRate = await page
      .locator('[data-testid="match-rate"]')
      .textContent();
    expect(parseFloat(matchRate || "0")).toBeGreaterThan(0);

    // 6. æŸ¥çœ‹è¯¦ç»†æŠ¥å‘Š
    await page.click('[data-testid="view-report-button"]');
    await expect(
      page.locator('[data-testid="reconciliation-report"]')
    ).toBeVisible();

    // 7. éªŒè¯æŠ¥å‘Šå†…å®¹
    await expect(page.locator('[data-testid="report-summary"]')).toContainText(
      "å¯¹è´¦å®Œæˆ"
    );
    await expect(page.locator('[data-testid="report-charts"]')).toBeVisible();
  });

  test("should handle file upload errors gracefully", async () => {
    await page.click('[data-testid="nav-reconciliation"]');

    // ä¸Šä¼ æ— æ•ˆæ–‡ä»¶
    await page.setInputFiles(
      '[data-testid="file-upload"]',
      "tests/fixtures/invalid-format.txt"
    );
    await page.click('[data-testid="upload-button"]');

    // éªŒè¯é”™è¯¯å¤„ç†
    await expect(page.locator('[data-testid="upload-error"]')).toBeVisible();
    await expect(page.locator('[data-testid="error-message"]')).toContainText(
      "æ–‡ä»¶æ ¼å¼æ— æ•ˆ"
    );
  });
});
```

### è·¨æµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯•

```typescript
// tests/e2e/cross-browser.spec.ts
import { test, devices } from "@playwright/test";

const browsers = [
  { name: "Chrome", device: devices["Desktop Chrome"] },
  { name: "Firefox", device: devices["Desktop Firefox"] },
  { name: "Safari", device: devices["Desktop Safari"] },
  { name: "Mobile", device: devices["iPhone 12"] },
];

browsers.forEach(({ name, device }) => {
  test.describe(`${name} Browser Tests`, () => {
    test.use(device);

    test("should render dashboard correctly", async ({ page }) => {
      await page.goto("/dashboard");

      // éªŒè¯å…³é”®å…ƒç´ 
      await expect(
        page.locator('[data-testid="dashboard-title"]')
      ).toBeVisible();
      await expect(page.locator('[data-testid="kpi-cards"]')).toBeVisible();
      await expect(
        page.locator('[data-testid="charts-section"]')
      ).toBeVisible();
    });
  });
});
```

## 6. æ€§èƒ½æµ‹è¯•

### k6 è´Ÿè½½æµ‹è¯•

```javascript
// backend/performance/k6-load-test.js
import http from "k6/http";
import { check, sleep } from "k6";
import { Rate } from "k6/metrics";

// è‡ªå®šä¹‰æŒ‡æ ‡
const errorRate = new Rate("errors");

export const options = {
  stages: [
    { duration: "2m", target: 10 }, // é¢„çƒ­
    { duration: "5m", target: 50 }, // è´Ÿè½½æµ‹è¯•
    { duration: "2m", target: 100 }, // å‹åŠ›æµ‹è¯•
    { duration: "5m", target: 100 }, // ä¿æŒå‹åŠ›
    { duration: "2m", target: 0 }, // é™å‹
  ],
  thresholds: {
    http_req_duration: ["p(95)<500"], // 95%è¯·æ±‚ < 500ms
    http_req_failed: ["rate<0.01"], // é”™è¯¯ç‡ < 1%
    errors: ["rate<0.1"], // è‡ªå®šä¹‰é”™è¯¯ç‡ < 10%
  },
};

export default function () {
  // å¥åº·æ£€æŸ¥
  let res = http.get("http://localhost:3001/api/health");
  check(res, {
    "health check status is 200": (r) => r.status === 200,
  }) || errorRate.add(1);

  // APIè´Ÿè½½æµ‹è¯•
  res = http.get("http://localhost:3001/api/reconciliation/records", {
    headers: {
      Authorization: "Bearer test-token",
    },
  });

  check(res, {
    "records API status is 200": (r) => r.status === 200,
    "response time OK": (r) => r.timings.duration < 500,
    "has records": (r) => JSON.parse(r.body).data.length >= 0,
  }) || errorRate.add(1);

  sleep(1);
}
```

### å‰ç«¯æ€§èƒ½æµ‹è¯•

```typescript
// tests/performance/lighthouse.test.ts
import { test } from "@playwright/test";
import { playAudit } from "playwright-lighthouse";

test.describe("Performance Audits", () => {
  test("should meet Lighthouse performance standards", async ({ page }) => {
    await page.goto("/dashboard");

    await playAudit({
      page,
      thresholds: {
        performance: 80,
        accessibility: 90,
        "best-practices": 80,
        seo: 80,
      },
      port: 9222,
    });
  });
});
```

## 7. CICD é›†æˆ

### GitHub Actions é…ç½®

```yaml
# .github/workflows/test-pipeline.yml
name: Test Pipeline

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  unit-tests:
    runs-on: ubuntu-latest

    services:
      postgres:
        image: postgres:15
        env:
          POSTGRES_PASSWORD: test
          POSTGRES_USER: test
          POSTGRES_DB: test_db
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5

      redis:
        image: redis:7
        options: >-
          --health-cmd "redis-cli ping"
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "18"
          cache: "npm"

      - name: Install dependencies
        run: npm ci

      - name: Run linting
        run: npm run lint

      - name: Run type checking
        run: npm run type-check

      - name: Run unit tests
        run: npm test -- --coverage --watchAll=false
        env:
          NODE_ENV: test
          DB_HOST: localhost
          DB_PORT: 5432
          DB_NAME: test_db
          DB_USER: test
          DB_PASSWORD: test
          REDIS_HOST: localhost
          REDIS_PORT: 6379

      - name: Upload coverage to Codecov
        uses: codecov/codecov-action@v3
        with:
          file: ./coverage/lcov.info
          flags: unittests

      - name: Check coverage threshold
        run: |
          COVERAGE=$(node -p "require('./coverage/coverage-summary.json').total.lines.pct")
          echo "Coverage: $COVERAGE%"
          if (( $(echo "$COVERAGE < 80" | bc -l) )); then
            echo "âŒ Coverage below threshold: $COVERAGE%"
            exit 1
          else
            echo "âœ… Coverage meets threshold: $COVERAGE%"
          fi

  integration-tests:
    runs-on: ubuntu-latest
    needs: unit-tests

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "18"
          cache: "npm"

      - name: Install dependencies
        run: npm ci

      - name: Run integration tests
        run: npm run test:integration

  e2e-tests:
    runs-on: ubuntu-latest
    needs: integration-tests

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "18"
          cache: "npm"

      - name: Install dependencies
        run: npm ci

      - name: Install Playwright browsers
        run: npx playwright install --with-deps

      - name: Build application
        run: npm run build

      - name: Run E2E tests
        run: npx playwright test

      - name: Upload E2E test results
        uses: actions/upload-artifact@v3
        if: always()
        with:
          name: playwright-report
          path: playwright-report/

  quality-gate:
    runs-on: ubuntu-latest
    needs: [unit-tests, integration-tests, e2e-tests]

    steps:
      - name: Quality Gate Success
        run: |
          echo "ğŸ‰ All tests passed!"
          echo "âœ… Unit tests: Passed"
          echo "âœ… Integration tests: Passed"  
          echo "âœ… E2E tests: Passed"
          echo "ğŸš€ Ready for deployment!"
```

## 8. æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡

### è¦†ç›–ç‡æŒ‡æ ‡

| æµ‹è¯•ç±»å‹     | å½“å‰çŠ¶æ€ | ç›®æ ‡ | å…³é”®æ¨¡å—è¦æ±‚       |
| ------------ | -------- | ---- | ------------------ |
| **å•å…ƒæµ‹è¯•** | 65%      | 80%+ | æ ¸å¿ƒä¸šåŠ¡é€»è¾‘: 95%+ |
| **é›†æˆæµ‹è¯•** | åŸºç¡€     | 70%+ | API æ¥å£: 85%+     |
| **E2E æµ‹è¯•** | å¾…å®Œå–„   | 60%+ | å…³é”®æµç¨‹: 80%+     |
| **æ€»ä½“è¦†ç›–** | -        | 80%+ | ç»„ä»¶æµ‹è¯•: 75%+     |

### è¦†ç›–ç‡æŠ¥å‘Šç”Ÿæˆ

```javascript
// scripts/generate-test-report.js
const fs = require("fs");
const path = require("path");

async function generateTestReport() {
  const coverageData = require("../coverage/coverage-summary.json");
  const testResults = require("../test-results.json");

  const report = {
    timestamp: new Date().toISOString(),
    coverage: {
      total: coverageData.total,
      byFile: Object.keys(coverageData)
        .filter((key) => key !== "total")
        .map((file) => ({
          file,
          coverage: coverageData[file],
        })),
    },
    tests: {
      total: testResults.numTotalTests,
      passed: testResults.numPassedTests,
      failed: testResults.numFailedTests,
      skipped: testResults.numPendingTests,
    },
    quality: {
      coverageScore: coverageData.total.lines.pct,
      testScore: (testResults.numPassedTests / testResults.numTotalTests) * 100,
      overallScore: calculateOverallScore(coverageData, testResults),
    },
  };

  // ç”ŸæˆHTMLæŠ¥å‘Š
  const htmlReport = generateHtmlReport(report);
  fs.writeFileSync("test-report.html", htmlReport);

  // ç”ŸæˆJSONæŠ¥å‘Š
  fs.writeFileSync("test-report.json", JSON.stringify(report, null, 2));

  console.log("ğŸ“Š Test report generated successfully!");
}

function calculateOverallScore(coverage, tests) {
  const coverageWeight = 0.6;
  const testWeight = 0.4;

  const coverageScore = coverage.total.lines.pct;
  const testScore = (tests.numPassedTests / tests.numTotalTests) * 100;

  return coverageScore * coverageWeight + testScore * testWeight;
}

generateTestReport();
```

## 9. è´¨é‡é—¨ç¦æœºåˆ¶

### è‡ªåŠ¨åŒ–è´¨é‡æ£€æŸ¥

```bash
# scripts/quality-gate.sh
#!/bin/bash

echo "ğŸ” Running Quality Gate Checks..."

# 1. è¿è¡Œæ‰€æœ‰æµ‹è¯•
echo "ğŸ“ Running tests..."
npm test -- --coverage --watchAll=false

# 2. æ£€æŸ¥è¦†ç›–ç‡
echo "ğŸ“Š Checking coverage..."
COVERAGE=$(node -p "require('./coverage/coverage-summary.json').total.lines.pct")
if (( $(echo "$COVERAGE < 80" | bc -l) )); then
  echo "âŒ Coverage below threshold: $COVERAGE%"
  exit 1
fi

# 3. æ£€æŸ¥ä»£ç è´¨é‡
echo "ğŸ”§ Running linting..."
npm run lint

# 4. ç±»å‹æ£€æŸ¥
echo "ğŸ¯ Type checking..."
npm run type-check

# 5. å®‰å…¨æ‰«æ
echo "ğŸ›¡ï¸ Security audit..."
npm audit --audit-level moderate

echo "âœ… Quality gate passed!"
```

### Pre-commit Hooks

```json
// package.json
{
  "husky": {
    "hooks": {
      "pre-commit": "lint-staged && npm run test:changed",
      "pre-push": "npm run quality-gate"
    }
  },
  "lint-staged": {
    "*.{ts,tsx}": ["eslint --fix", "prettier --write"],
    "*.{md,json}": ["prettier --write"]
  }
}
```

## 10. æœ€ä½³å®è·µ

### æµ‹è¯•ç¼–å†™åŸåˆ™

1. **AAA æ¨¡å¼**: Arrange - Act - Assert
2. **Given-When-Then**: ä¸šåŠ¡é€»è¾‘æµ‹è¯•
3. **æè¿°æ€§å‘½å**: æ¸…æ™°è¡¨è¾¾æµ‹è¯•æ„å›¾
4. **å•ä¸€èŒè´£**: æ¯ä¸ªæµ‹è¯•åªéªŒè¯ä¸€ä¸ªè¡Œä¸º
5. **ç‹¬ç«‹æ€§**: æµ‹è¯•é—´ä¸ç›¸äº’ä¾èµ–

### å‘½åçº¦å®š

- **æµ‹è¯•æ–‡ä»¶**: `*.test.ts` æˆ– `*.spec.ts`
- **æµ‹è¯•ç›®å½•**: `__tests__` æˆ– `tests/`
- **Mock æ–‡ä»¶**: `__mocks__`
- **Fixtures**: `tests/fixtures/`

### Mock ç­–ç•¥

```typescript
// 1. å¤–éƒ¨ä¾èµ–å§‹ç»ˆMock
jest.mock("../services/ExternalApiService");

// 2. æ•°æ®åº“ä½¿ç”¨Test Database
beforeAll(async () => {
  await setupTestDatabase();
});

// 3. æ—¶é—´å‡½æ•°Mock
beforeEach(() => {
  jest.useFakeTimers();
  jest.setSystemTime(new Date("2024-01-01"));
});

// 4. ç½‘ç»œè¯·æ±‚ä½¿ç”¨MSW
import { rest } from "msw";
import { setupServer } from "msw/node";

const server = setupServer(
  rest.get("/api/data", (req, res, ctx) => {
    return res(ctx.json({ data: "test" }));
  })
);
```

### æ•°æ®ç®¡ç†

```typescript
// Test Fixtures
export const mockReconciliationRecord = {
  id: 1,
  amount: 100.5,
  date: "2024-01-01",
  status: "pending",
  description: "Test transaction",
};

// Factory Pattern
export class RecordFactory {
  static create(overrides = {}) {
    return {
      ...mockReconciliationRecord,
      ...overrides,
      id: Math.random(),
    };
  }

  static createMany(count: number, overrides = {}) {
    return Array.from({ length: count }, () => this.create(overrides));
  }
}
```

### å‘½ä»¤è¡Œå·¥å…·

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
npm test -- reconciliation.service.test.ts

# ç›‘è§†æ¨¡å¼
npm test -- --watch

# è¦†ç›–ç‡æŠ¥å‘Š
npm run test:coverage

# ç«¯åˆ°ç«¯æµ‹è¯•
npm run test:e2e

# æ€§èƒ½æµ‹è¯•
npm run test:performance

# å®Œæ•´è´¨é‡æ£€æŸ¥
npm run quality-gate
```

---

## ğŸ“‹ å®æ–½è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µ (Week 1-2): åŸºç¡€è®¾æ–½

- [ ] é…ç½® Jest å’Œæµ‹è¯•ç¯å¢ƒ
- [ ] è®¾ç½® CI/CD æµæ°´çº¿
- [ ] å»ºç«‹æµ‹è¯•æ•°æ®åº“
- [ ] åˆ›å»ºæµ‹è¯•å·¥å…·å‡½æ•°

### ç¬¬äºŒé˜¶æ®µ (Week 3-4): å•å…ƒæµ‹è¯•

- [ ] æ ¸å¿ƒä¸šåŠ¡é€»è¾‘æµ‹è¯•
- [ ] å·¥å…·å‡½æ•°æµ‹è¯•
- [ ] React ç»„ä»¶æµ‹è¯•
- [ ] æœåŠ¡å±‚æµ‹è¯•

### ç¬¬ä¸‰é˜¶æ®µ (Week 5-6): é›†æˆæµ‹è¯•

- [ ] API æ¥å£æµ‹è¯•
- [ ] æ•°æ®åº“é›†æˆæµ‹è¯•
- [ ] å¤–éƒ¨æœåŠ¡é›†æˆæµ‹è¯•
- [ ] ç»„ä»¶é—´äº¤äº’æµ‹è¯•

### ç¬¬å››é˜¶æ®µ (Week 7-8): E2E æµ‹è¯•

- [ ] å…³é”®ä¸šåŠ¡æµç¨‹æµ‹è¯•
- [ ] ç”¨æˆ·å®Œæ•´æ—…ç¨‹æµ‹è¯•
- [ ] è·¨æµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•é›†æˆ

### ç¬¬äº”é˜¶æ®µ (Week 9-10): ä¼˜åŒ–ä¸ç›‘æ§

- [ ] æµ‹è¯•æ€§èƒ½ä¼˜åŒ–
- [ ] æŠ¥å‘Šç³»ç»Ÿå®Œå–„
- [ ] è´¨é‡ç›‘æ§è®¾ç½®
- [ ] å›¢é˜ŸåŸ¹è®­

---

**æ³¨æ„**: æœ¬æµ‹è¯•ä½“ç³»æ”¹è¿›æ–¹æ¡ˆéœ€è¦æ ¹æ®å®é™…é¡¹ç›®è¿›å±•è¿›è¡Œè°ƒæ•´ã€‚å»ºè®®å®šæœŸå›é¡¾æµ‹è¯•æŒ‡æ ‡å’Œç­–ç•¥ä¼˜åŒ–ã€‚
